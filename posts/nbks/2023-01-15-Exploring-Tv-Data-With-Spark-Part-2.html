<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-15">
<meta name="description" content="From Questions to Visualizations">

<title>Orgulo.us - Exploring Television Data With Spark - Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Orgulo.us</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Shoklan"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Exploring Television Data With Spark - Part 2</h1>
                  <div>
        <div class="description">
          From Questions to Visualizations
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">spark</div>
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">datasets</div>
                <div class="quarto-category">visualization</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 15, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#moving-from-spark-to-visualizations." id="toc-moving-from-spark-to-visualizations." class="nav-link active" data-scroll-target="#moving-from-spark-to-visualizations.">Moving From Spark to Visualizations.</a></li>
  <li><a href="#lets-start-asking-some-questions." id="toc-lets-start-asking-some-questions." class="nav-link" data-scroll-target="#lets-start-asking-some-questions.">Let’s Start Asking Some Questions.</a>
  <ul class="collapse">
  <li><a href="#qq-plot-of-numeric-values" id="toc-qq-plot-of-numeric-values" class="nav-link" data-scroll-target="#qq-plot-of-numeric-values">QQ plot of Numeric Values</a>
  <ul class="collapse">
  <li><a href="#are-ratings-normally-distributed" id="toc-are-ratings-normally-distributed" class="nav-link" data-scroll-target="#are-ratings-normally-distributed">Are Ratings Normally Distributed?</a></li>
  <li><a href="#is-duration-normally-distributed" id="toc-is-duration-normally-distributed" class="nav-link" data-scroll-target="#is-duration-normally-distributed">Is Duration Normally Distributed?</a></li>
  <li><a href="#are-votes-normally-distributed" id="toc-are-votes-normally-distributed" class="nav-link" data-scroll-target="#are-votes-normally-distributed">Are Votes Normally Distributed?</a></li>
  </ul></li>
  <li><a href="#ridge-plot-of-genre-ratings" id="toc-ridge-plot-of-genre-ratings" class="nav-link" data-scroll-target="#ridge-plot-of-genre-ratings">Ridge Plot of Genre Ratings</a></li>
  <li><a href="#jointplot" id="toc-jointplot" class="nav-link" data-scroll-target="#jointplot">JointPlot</a></li>
  <li><a href="#violin-plot" id="toc-violin-plot" class="nav-link" data-scroll-target="#violin-plot">Violin Plot</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="moving-from-spark-to-visualizations." class="level1">
<h1>Moving From Spark to Visualizations.</h1>
<p>In the last post, we reviewed some data cleaning and how to use Apache spark. We’re going to move on to visualizations; while I like the data tables and numbers, when showing the conclusions to others then visualizations are the way to go. Numbers without context are meaningless and the reason they mean something to the individual making the analysis is that you have the data as context. But, those you’re showing the conclusinos too do not - and they didn’t spend hours cleaning and thinking about the data like you did.</p>
<p>We’ll add all the cleaning from before just for that context I was talking about; I would recommending seeing the part one of this series if your curious about that process.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the schema:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>shows <span class="op">=</span> StructType([</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Ignore'</span>, IntegerType(), <span class="va">True</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Name'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Year'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Guide'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Duration'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Genres'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Ratings'</span>, FloatType(), <span class="va">True</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Actors'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Votes'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> spark.read.csv(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">str</span>(Path(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'_data'</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AllThrillerSeriesListClean.csv'</span>)),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        header<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>shows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(<span class="st">'Ignore'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'isOngoing'</span>,     <span class="co"># Target this column</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    F.udf(                              <span class="co"># define a udf</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.strip()[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">'–'</span>) <span class="co"># use the logic we already wrote.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Year'</span>)                            <span class="co"># pass the column we're applying this to.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'startYear'</span>, F.udf( <span class="kw">lambda</span> x: x.split(<span class="st">'–'</span>)[<span class="dv">0</span>])(<span class="st">'Year'</span>))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.udf( <span class="kw">lambda</span> x: <span class="bu">int</span>(x.replace(<span class="st">','</span>, <span class="st">''</span>)))(<span class="st">'Votes'</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.cast(IntegerType(), data[<span class="st">'Votes'</span>]))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.split(data[<span class="st">'Genres'</span>], <span class="st">','</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.explode(data[<span class="st">'Genre'</span>]))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.split(data[<span class="st">'Actors'</span>], <span class="st">','</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.explode(data[<span class="st">'Actor'</span>]))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Gotta clean up the inputs:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.udf(<span class="kw">lambda</span> x: x.strip())(<span class="st">'Genre'</span>))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.udf(<span class="kw">lambda</span> x: x.strip())(<span class="st">'Actor'</span>))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.udf( <span class="kw">lambda</span> x: <span class="bu">int</span>(x) )(<span class="st">'Votes'</span>))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>cData <span class="op">=</span> data.select(</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Name'</span>, <span class="st">'Year'</span>, <span class="st">'Guide'</span>, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Duration'</span>, <span class="st">'Ratings'</span>, <span class="st">'Votes'</span>, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isOngoing'</span>, <span class="st">'startYear'</span>, <span class="st">'Genre'</span>, <span class="st">'Actor'</span>]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>cData.show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
| Name|  Year| Guide|Duration|Ratings|Votes|isOngoing|startYear|    Genre|             Actor|
+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|       Kyle Soller|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action| Stellan Skarsgård|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|Genevieve O'Reilly|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|       Kyle Soller|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure| Stellan Skarsgård|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|Genevieve O'Reilly|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|    Drama|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|    Drama|       Kyle Soller|
+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
only showing top 10 rows
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="lets-start-asking-some-questions." class="level1">
<h1>Let’s Start Asking Some Questions.</h1>
<p>Looking at the data we have, we’ll be asking: 1. Are the numeric columns Normally Distributed? 2. What is the Distribution of Ratings for the top Genres? 3. How does a show’s Ongoing status affect it’s ratings?</p>
<section id="qq-plot-of-numeric-values" class="level2">
<h2 class="anchored" data-anchor-id="qq-plot-of-numeric-values">QQ plot of Numeric Values</h2>
<p>A <strong>Quantile-Quantile Plot</strong> is a plot which takes the data and compares it against commonly another distribution. While it is less well known, it is most commonly used as a visual indicator of whether a dataset is Normally Distributed. Since matplotlib and seaborn don’t have this built in we’ll need to use a different library this time: statsmodels.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pylab <span class="im">as</span> py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To plot the data we’ll need to pull it out of Spark and convert it to pandas; we’ve done this enough at this point. But, we’ve never used the sql api like this before. I quite like this interface since SQL queries are simply to read.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To use this, we'll need what is called a View; this is an idea from SQL</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cData.createOrReplaceTempView(<span class="st">"TMP"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> spark.sql(<span class="st">"SELECT Ratings,Duration,Votes FROM TMP WHERE Duration IS NOT NULL"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> tmp.withColumn(<span class="st">'nDuration'</span>, F.udf( <span class="kw">lambda</span> x: x.replace(<span class="st">' min'</span>, <span class="st">''</span>).replace(<span class="st">','</span>, <span class="st">''</span>))(<span class="st">'Duration'</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>qqData <span class="op">=</span> tmp.select([<span class="st">'Ratings'</span>, <span class="st">'nDuration'</span>, <span class="st">'Votes'</span>]).toPandas()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>qqData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>nDuration</th>
      <th>Votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.4</td>
      <td>40</td>
      <td>82474</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.4</td>
      <td>40</td>
      <td>82474</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.4</td>
      <td>40</td>
      <td>82474</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.4</td>
      <td>40</td>
      <td>82474</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.4</td>
      <td>40</td>
      <td>82474</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>26228</th>
      <td>6.4</td>
      <td>45</td>
      <td>25</td>
    </tr>
    <tr>
      <th>26229</th>
      <td>6.4</td>
      <td>45</td>
      <td>25</td>
    </tr>
    <tr>
      <th>26230</th>
      <td>6.4</td>
      <td>45</td>
      <td>25</td>
    </tr>
    <tr>
      <th>26231</th>
      <td>6.4</td>
      <td>45</td>
      <td>25</td>
    </tr>
    <tr>
      <th>26232</th>
      <td>6.4</td>
      <td>45</td>
      <td>25</td>
    </tr>
  </tbody>
</table>
<p>26233 rows × 3 columns</p>
</div>
</div>
</div>
<section id="are-ratings-normally-distributed" class="level3">
<h3 class="anchored" data-anchor-id="are-ratings-normally-distributed">Are Ratings Normally Distributed?</h3>
<p>Now we’ll check if the Ratings are <em>Normally Distributed</em>.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the the y=x line for comparison.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sm.qqplot(qqData.Ratings, line <span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#py.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>From the above, this is not a normally distributed dataset. When we have situations like this, it is not uncommon to try a log tranform if the data does not fit. The reason for this is that taking the logarithmic of the data maintains the underlying mathematical relationship. So, let’s try it!</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sm.qqplot(np.log(qqData.Ratings), line <span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Still No.&nbsp;We’ll want to avoid any model which has linear prerequisites.</p>
</section>
<section id="is-duration-normally-distributed" class="level3">
<h3 class="anchored" data-anchor-id="is-duration-normally-distributed">Is Duration Normally Distributed?</h3>
<p>The duration of a show is very likely to not be normally distributed. The length is not random and there are very few posssible choices. But, we’re going to check anyways.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sm.qqplot(qqData.nDuration.astype(<span class="bu">int</span>), line <span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And, expected no.</p>
</section>
<section id="are-votes-normally-distributed" class="level3">
<h3 class="anchored" data-anchor-id="are-votes-normally-distributed">Are Votes Normally Distributed?</h3>
<p>We would expect votes to be normally distributed as this is the kind of process where as you would select samples it should approach normal.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sm.qqplot(qqData.Votes.astype(<span class="bu">int</span>), line <span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Still even this is not normally distributed. This is starting to get worrying because at least this would be expected to be normally distributed.</p>
</section>
</section>
<section id="ridge-plot-of-genre-ratings" class="level2">
<h2 class="anchored" data-anchor-id="ridge-plot-of-genre-ratings">Ridge Plot of Genre Ratings</h2>
<p>Looking at the distribution of numeric variables can be useful. Normally, we could do a <em>Distribution Plot</em> or a <em>Histogram</em> to visualize this. But, I thought I would do something more interesting: a <strong>Ridge Plot</strong>. So, a <em>Ridge Plot</em> shows the distribution of values but conditioned on a category. And, we’re going to use it to check the ratings for the top categories and how they break down. First we’ll need to get our data.</p>
<div class="cell" data-execution_count="377">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> mean <span class="im">as</span> sMean, col</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use results from previous post:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> cData.select([<span class="st">'Genre'</span>, <span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]).groupBy(<span class="st">'Genre'</span>).agg(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    sMean(<span class="st">'Ratings'</span>).alias(<span class="st">"Mean"</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sMean(<span class="st">'Votes'</span>).alias(<span class="st">'Votes'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    ).orderBy(F.desc(<span class="st">"Mean"</span>)).toPandas()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>results.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="377">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Genre</th>
      <th>Mean</th>
      <th>Votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Biography</td>
      <td>7.795238</td>
      <td>33137.952381</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Music</td>
      <td>7.475000</td>
      <td>413.625000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>History</td>
      <td>7.416667</td>
      <td>3330.541667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Animation</td>
      <td>7.270712</td>
      <td>8447.388742</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Fantasy</td>
      <td>7.231312</td>
      <td>18573.573756</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Adventure</td>
      <td>7.228473</td>
      <td>8999.588235</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Crime</td>
      <td>7.225607</td>
      <td>15978.954034</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Comedy</td>
      <td>7.223730</td>
      <td>4206.774311</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Family</td>
      <td>7.207407</td>
      <td>635.759259</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Drama</td>
      <td>7.203856</td>
      <td>17351.695414</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We’ll make a new SQL View with Apache Spark to filter out the top Genres.</p>
<div class="cell" data-execution_count="378">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cData.createOrReplaceTempView(<span class="st">"Explore"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using our results, collect the categories to filter for.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="st">','</span>.join([<span class="ss">f"'</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'"</span> <span class="cf">for</span> x <span class="kw">in</span> results.head(<span class="dv">8</span>).Genre.tolist()])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ridgeSlice <span class="op">=</span> spark.sql(<span class="ss">f"SELECT Genre,Ratings FROM Explore WHERE Genre IN( </span><span class="sc">{</span> values <span class="sc">}</span><span class="ss"> )"</span>).toPandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="385">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is just to stop some spam.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Theming:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"white"</span>, rc<span class="op">=</span>{<span class="st">"axes.facecolor"</span>: (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)})</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pal <span class="op">=</span> sns.dark_palette(<span class="st">"seagreen"</span>, n_colors<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">14</span>,<span class="dv">7</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(ridgeSlice, row<span class="op">=</span><span class="st">"Genre"</span>, hue<span class="op">=</span><span class="st">"Genre"</span>, aspect<span class="op">=</span><span class="dv">15</span>, height<span class="op">=</span><span class="fl">.5</span>, palette<span class="op">=</span>pal)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the densities in a few steps</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(sns.kdeplot, <span class="st">"Ratings"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      bw_adjust<span class="op">=</span><span class="fl">.5</span>, clip_on<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>      fill<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="dv">1</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(sns.kdeplot, <span class="st">"Ratings"</span>, clip_on<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">"w"</span>, lw<span class="op">=</span><span class="dv">2</span>, bw_adjust<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># passing color=None to refline() uses the hue mapping</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>g.refline(y<span class="op">=</span><span class="dv">0</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">"-"</span>, color<span class="op">=</span><span class="va">None</span>, clip_on<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define and use a simple function to label the plot in axes coordinates</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(x, color, label):</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> plt.gca()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="dv">0</span>, <span class="fl">.2</span>, label, fontweight<span class="op">=</span><span class="st">"bold"</span>, color<span class="op">=</span>color,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">"left"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>ax.transAxes)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(label, <span class="st">"Genre"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove axes details that don't play well with overlap</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">""</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">set</span>(yticks<span class="op">=</span>[], ylabel<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>g.despine(bottom<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Music quickly stands out; people either like or dislike the show and there is little in between. Fantasy and Biography are clumped a little under 8 but mostly concentrated. The others are closer to what we’d expect from a normal distribution. Comedy, Animation and History are interesting since there is more spread among the ratings</p>
</section>
<section id="jointplot" class="level2">
<h2 class="anchored" data-anchor-id="jointplot">JointPlot</h2>
<p>A <em>Joinplot</em> is a nicer looking scatterplot. It includes some of the same information but also you can add distibution information. Personally, I like the <em>Hexagons</em> so we’re going to use those. And, we’re going to see how the year affects the Rating over time.</p>
<div class="cell" data-execution_count="391">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> cData.select([<span class="st">'startYear'</span>, <span class="st">'Ratings'</span>]).toPandas()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> results.assign(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        Year <span class="op">=</span> results.startYear.astype(<span class="bu">int</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    results.head(<span class="dv">15</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( e )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>invalid literal for int() with base 10: 's2018'</code></pre>
</div>
</div>
<p>Uh oh, looks like we’ve got some more cleaning to do. Let’s look at what is affected and see how widespread this is.</p>
<div class="cell" data-execution_count="392">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>results.loc[ results.startYear <span class="op">==</span> <span class="st">'s2018'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="392">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>startYear</th>
      <th>Ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>24638</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24639</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24640</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24641</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24642</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24643</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24644</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24645</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24646</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24647</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24648</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>24649</th>
      <td>s2018</td>
      <td>6.1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This might be the same movie/show which is being exploded out. We’re going to just fix it for our analysis at this point. Again, if we were getting this data from a Data Engineer then we’d want to discuss this with them to clean this upstream.</p>
<div class="cell" data-execution_count="393">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'startYear'</span>] <span class="op">=</span> results.startYear.<span class="bu">str</span>.replace(<span class="st">'s2018'</span>, <span class="st">'2018'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> results.assign(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    Year <span class="op">=</span> results.startYear.astype(<span class="bu">int</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>results.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="393">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>startYear</th>
      <th>Ratings</th>
      <th>Year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2022</td>
      <td>8.4</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2022</td>
      <td>8.0</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2022</td>
      <td>8.0</td>
      <td>2022</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2022</td>
      <td>8.0</td>
      <td>2022</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>So, let’s see the Data!</p>
<div class="cell" data-execution_count="394">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.jointplot(data<span class="op">=</span>results, x<span class="op">=</span><span class="st">"Year"</span>, y<span class="op">=</span><span class="st">"Ratings"</span>, kind<span class="op">=</span><span class="st">"hex"</span>, color<span class="op">=</span><span class="st">'seagreen'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Honestly, I expected there to be a stronger relationship here. There is definitely a relationship here about the latest years beginning to fall though. If this was for some kind of report maybe it would be work breaking these into a <em>Ridge Plots</em> conditioned on the year.</p>
</section>
<section id="violin-plot" class="level2">
<h2 class="anchored" data-anchor-id="violin-plot">Violin Plot</h2>
<p><em>Violin Plots</em> are similar to Box and Whisker plots but they also add a visual element to show the distribution. We’re going to check out whether a show being finished or not has an impact on the Ratings.</p>
<div class="cell" data-execution_count="395">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">14</span>,<span class="dv">7</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"white"</span>, rc<span class="op">=</span>{<span class="st">"axes.facecolor"</span>: (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">'legend.facecolor'</span>:<span class="st">'white'</span>})</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>pal <span class="op">=</span> sns.dark_palette(<span class="st">"seagreen"</span>, n_colors<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>violinData, x<span class="op">=</span><span class="st">"Genre"</span>, y<span class="op">=</span><span class="st">"Ratings"</span>, split<span class="op">=</span><span class="va">True</span>, hue<span class="op">=</span><span class="st">"isOngoing"</span>, palette<span class="op">=</span>pal)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2023-01-15-Exploring-Tv-Data-With-Spark-Part-2_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There is something really strange going on with the <strong>Biography</strong> category. In a real analysis we’d want to dig into Biography to pull this apart more.</p>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>We’ll end this here. Hopefully this was an interesting to read over as it was to explore.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>