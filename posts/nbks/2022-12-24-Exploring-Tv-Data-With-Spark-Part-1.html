<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-12-27">
<meta name="description" content="How to Use Spark in Python.">

<title>Orgulo.us - Exploring Television Data With Spark - Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../Logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Orgulo.us</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Shoklan"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Exploring Television Data With Spark - Part 1</h1>
                  <div>
        <div class="description">
          How to Use Spark in Python.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">spark</div>
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">datasets</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 27, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#spark-and-pandas-and-movies" id="toc-spark-and-pandas-and-movies" class="nav-link active" data-scroll-target="#spark-and-pandas-and-movies">Spark and Pandas and Movies</a></li>
  <li><a href="#pandas-for-exploration" id="toc-pandas-for-exploration" class="nav-link" data-scroll-target="#pandas-for-exploration">Pandas for Exploration</a>
  <ul class="collapse">
  <li><a href="#explode-a-column" id="toc-explode-a-column" class="nav-link" data-scroll-target="#explode-a-column">Explode a Column!</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a>
  <ul class="collapse">
  <li><a href="#if-we-had-a-data-engineer" id="toc-if-we-had-a-data-engineer" class="nav-link" data-scroll-target="#if-we-had-a-data-engineer">If We Had a Data Engineer…</a></li>
  </ul></li>
  <li><a href="#what-kinds-of-movies" id="toc-what-kinds-of-movies" class="nav-link" data-scroll-target="#what-kinds-of-movies">What kinds of Movies…?</a></li>
  <li><a href="#lets-add-apache-spark" id="toc-lets-add-apache-spark" class="nav-link" data-scroll-target="#lets-add-apache-spark">Let’s Add Apache Spark</a></li>
  </ul></li>
  <li><a href="#conclusions-and-thoughts" id="toc-conclusions-and-thoughts" class="nav-link" data-scroll-target="#conclusions-and-thoughts">Conclusions and Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="spark-and-pandas-and-movies" class="level1">
<h1>Spark and Pandas and Movies</h1>
<p>I found some data online which is of some interest about movies and TV shows. And, no, this is not he IMBD data set which floats around for people’s use but is instead from someone on <a href="https://www.kaggle.com/datasets/aklimarimi/thriller-crime-action">Kaggle</a> which scraped lots of different websites for Thriller, Crime and Action shows. The dataset is small enough to be used with Pandas but large enough to be used to practice some Apache Spark! So, let’s get to it.</p>
</section>
<section id="pandas-for-exploration" class="level1">
<h1>Pandas for Exploration</h1>
<p>Exploring a bit of the data for problems is what I’d normally do. With Pandas, we can limit the number of rows imported to check for obvious problems before we start expanding our analysis to the whole dataset. This might seem odd considering that pandas can definitely import all this data but this is practice for larger datasets. There will be data which is simply too much for pandas but is not for Apache Spark. And, this is when using Spark will be useful but we also want the data to be as clean as possible before starting to work with it in spark. The last thing I want to do is have to try to clean the data in Spark on the fly or have to re-import data over and over for easily preventable problems.</p>
<p>For our initial check, we’ll spot check the data.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(Path(<span class="st">'data'</span>, <span class="st">'AllThrillerSeriesList.csv'</span>), nrows <span class="op">=</span> <span class="dv">500</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 500 entries, 0 to 499
Data columns (total 9 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   Unnamed: 0            500 non-null    int64  
 1   Name                  500 non-null    object 
 2   Year                  500 non-null    object 
 3   Tv Certificate        461 non-null    object 
 4   Duration per episode  478 non-null    object 
 5   Genre                 500 non-null    object 
 6   Ratings               500 non-null    float64
 7   Actor/Actress         500 non-null    object 
 8   Votes                 500 non-null    object 
dtypes: float64(1), int64(1), object(7)
memory usage: 35.3+ KB</code></pre>
</div>
</div>
<p>First thing of note is that there is this weird <code>Unnamed: 0</code> Column in the data. I also see that there are quite a few columns coming in as String objects when they definitely should be coming in as Intergers: such as the Year or Ratings or Votes. At least <code>Ratings</code> did come in correctly as a Float object for aggregation. Let’s check the actual values.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Unnamed: 0</th>
      <th>Name</th>
      <th>Year</th>
      <th>Tv Certificate</th>
      <th>Duration per episode</th>
      <th>Genre</th>
      <th>Ratings</th>
      <th>Actor/Actress</th>
      <th>Votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Andor</td>
      <td>2022–</td>
      <td>TV-14</td>
      <td>40 min</td>
      <td>Action, Adventure, Drama</td>
      <td>8.4</td>
      <td>Diego Luna, Kyle Soller, Stellan Skarsgård, G...</td>
      <td>82,474</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>The Peripheral</td>
      <td>2022–</td>
      <td>TV-MA</td>
      <td>NaN</td>
      <td>Drama, Mystery, Sci-Fi</td>
      <td>8.0</td>
      <td>Chloë Grace Moretz, Gary Carr, Jack Reynor, J...</td>
      <td>34,768</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>The Walking Dead</td>
      <td>2010–2022</td>
      <td>TV-MA</td>
      <td>44 min</td>
      <td>Drama, Horror, Thriller</td>
      <td>8.1</td>
      <td>Andrew Lincoln, Norman Reedus, Melissa McBrid...</td>
      <td>988,666</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Criminal Minds</td>
      <td>2005–</td>
      <td>TV-14</td>
      <td>42 min</td>
      <td>Crime, Drama, Mystery</td>
      <td>8.1</td>
      <td>Kirsten Vangsness, Matthew Gray Gubler, A.J. ...</td>
      <td>198,262</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Breaking Bad</td>
      <td>2008–2013</td>
      <td>TV-MA</td>
      <td>49 min</td>
      <td>Crime, Drama, Thriller</td>
      <td>9.5</td>
      <td>Bryan Cranston, Aaron Paul, Anna Gunn, Betsy ...</td>
      <td>1,872,005</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>So, the <code>Unnamed</code> column is some sort of index column. We wont need that for anything so we’ll definitely be dropping that. The <code>Year</code> column is actually the Years the show was running as oppposed to the year it was released. The votes failed to import as numbers because they have a comma in them; this is common with web scraping and we can simply remove it and convert it to a number. We also have a missing value for the <code>Duration per Episode</code> column. And, lastly, I dislike these column names and we’ll need to fix so that they’re something more usable.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>colReplace <span class="op">=</span> [<span class="st">'Ignore'</span>, <span class="st">'Name'</span>, <span class="st">'Year'</span>, <span class="st">'Guide'</span>, <span class="st">'Duration'</span>, <span class="st">'Genres'</span>, <span class="st">'Ratings'</span>, <span class="st">'Actors'</span>, <span class="st">'Votes'</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> colReplace</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(<span class="st">'Ignore'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Year</th>
      <th>Guide</th>
      <th>Duration</th>
      <th>Genres</th>
      <th>Ratings</th>
      <th>Actors</th>
      <th>Votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>TV-14</td>
      <td>40 min</td>
      <td>Action, Adventure, Drama</td>
      <td>8.4</td>
      <td>Diego Luna, Kyle Soller, Stellan Skarsgård, G...</td>
      <td>82,474</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Peripheral</td>
      <td>2022–</td>
      <td>TV-MA</td>
      <td>NaN</td>
      <td>Drama, Mystery, Sci-Fi</td>
      <td>8.0</td>
      <td>Chloë Grace Moretz, Gary Carr, Jack Reynor, J...</td>
      <td>34,768</td>
    </tr>
    <tr>
      <th>2</th>
      <td>The Walking Dead</td>
      <td>2010–2022</td>
      <td>TV-MA</td>
      <td>44 min</td>
      <td>Drama, Horror, Thriller</td>
      <td>8.1</td>
      <td>Andrew Lincoln, Norman Reedus, Melissa McBrid...</td>
      <td>988,666</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Criminal Minds</td>
      <td>2005–</td>
      <td>TV-14</td>
      <td>42 min</td>
      <td>Crime, Drama, Mystery</td>
      <td>8.1</td>
      <td>Kirsten Vangsness, Matthew Gray Gubler, A.J. ...</td>
      <td>198,262</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Breaking Bad</td>
      <td>2008–2013</td>
      <td>TV-MA</td>
      <td>49 min</td>
      <td>Crime, Drama, Thriller</td>
      <td>9.5</td>
      <td>Bryan Cranston, Aaron Paul, Anna Gunn, Betsy ...</td>
      <td>1,872,005</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Dark</td>
      <td>2017–2020</td>
      <td>TV-MA</td>
      <td>60 min</td>
      <td>Crime, Drama, Mystery</td>
      <td>8.7</td>
      <td>Louis Hofmann, Karoline Eichhorn, Lisa Vicari...</td>
      <td>384,702</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Manifest</td>
      <td>2018–</td>
      <td>TV-14</td>
      <td>43 min</td>
      <td>Drama, Mystery, Sci-Fi</td>
      <td>7.1</td>
      <td>Melissa Roxburgh, Josh Dallas, J.R. Ramirez, ...</td>
      <td>66,158</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stranger Things</td>
      <td>2016–</td>
      <td>TV-14</td>
      <td>51 min</td>
      <td>Drama, Fantasy, Horror</td>
      <td>8.7</td>
      <td>Millie Bobby Brown, Finn Wolfhard, Winona Ryd...</td>
      <td>1,179,168</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Guillermo del Toro's Cabinet of Curiosities</td>
      <td>2022–</td>
      <td>TV-MA</td>
      <td>60 min</td>
      <td>Drama, Horror, Mystery</td>
      <td>7.1</td>
      <td>Lize Johnston, Kevin Keppy, Kate Micucci, F. ...</td>
      <td>33,660</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Echo 3</td>
      <td>2022–</td>
      <td>TV-MA</td>
      <td>49 min</td>
      <td>Action, Drama, Thriller</td>
      <td>6.6</td>
      <td>Michiel Huisman, Luke Evans, Jessica Ann Coll...</td>
      <td>1,333</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Better. Now, I would like to now if a series is ongoing or not since this might be meaningful information. Looking at the format of the <code>Year</code> column, we can check if the last character is a <code>-</code> and that should tell us if the movie is ongoing or not. Of course, when you try this is does not work because the <code>Year</code> has extra space around it:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>).Year.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0     
1     
2    2
3     
4    3
5    0
6     
7     
8     
9     
Name: Year, dtype: object</code></pre>
</div>
</div>
<p>So, we will need to clear out that extra space before we can get what we want:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>).Year.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strip()[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">'-'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>0    False
1    False
2    False
3    False
4    False
5    False
6    False
7    False
8    False
9    False
Name: Year, dtype: bool</code></pre>
</div>
</div>
<p>Looking at the columns above, that’s not correct so what is going on? Turns out that the character at the end is in fact not a hypen but something else that looks like a hyphen. Or, it might be some form of encoding mismatch becuase it’s not the same thing:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data.Year.iloc[<span class="dv">1</span>].strip()[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">'-'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>False</code></pre>
</div>
</div>
<p>Rather than figure out what exactly it is, we’re just going to copy it.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>).Year.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strip()[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">'–'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0     True
1     True
2    False
3     True
4    False
5    False
6     True
7     True
8     True
9     True
Name: Year, dtype: bool</code></pre>
</div>
</div>
<p>The starting year would actually be useful to know about since there are disagreements about which years of movies have the best shows. Pulling that out is going to be really simple. We’ll just strip the extra white space, split on our weird hyphen and then pull the first value:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>).Year.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">'–'</span>)[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>0    2022
1    2022
2    2010
3    2005
4    2008
5    2017
6    2018
7    2016
8    2022
9    2022
Name: Year, dtype: object</code></pre>
</div>
</div>
<p>And, fix the votes:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>).Votes.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x.replace(<span class="st">','</span>, <span class="st">''</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0      82474
1      34768
2     988666
3     198262
4    1872005
5     384702
6      66158
7    1179168
8      33660
9       1333
Name: Votes, dtype: int64</code></pre>
</div>
</div>
<section id="explode-a-column" class="level2">
<h2 class="anchored" data-anchor-id="explode-a-column">Explode a Column!</h2>
<p>This is surprisignly common in R but not very much in Python for some reason. When I was initially trying to work on these sorts of problems, I found that <code>explode()</code> was not something which was supported with Python. It did exists in Apache Spark - which is where I found the actual name for this action - so I had to work on writing my own. Thankfully, I don’t have to keep track of my worse version and use the official call now.</p>
<p>To explode a column means to duplicate rows by splitting up the values in a column. If we look at the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.explode.html#pandas-dataframe-explode">documentation</a> for this:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'A'</span>: [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], <span class="st">'foo'</span>, [], [<span class="dv">3</span>, <span class="dv">4</span>]],</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'B'</span>: <span class="dv">1</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'C'</span>: [[<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], np.nan, [], [<span class="st">'d'</span>, <span class="st">'e'</span>]]})</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[0, 1, 2]</td>
      <td>1</td>
      <td>[a, b, c]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>foo</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[]</td>
      <td>1</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[3, 4]</td>
      <td>1</td>
      <td>[d, e]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.explode(<span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>[a, b, c]</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>[a, b, c]</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>1</td>
      <td>[a, b, c]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>foo</td>
      <td>1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>1</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>[d, e]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>[d, e]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>For our data, we’ll want to do this for the <code>Genre</code> and the <code>Actor</code> columns. You will notice that to do this we’ll need the column to contain a list instead of the comma separated values we have now. A quick <code>assign</code> and <code>apply</code> will fix this for us.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TIME TO EXPLODE</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I am so happy this is a thing.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.assign(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    Genre <span class="op">=</span> data.Genres.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">','</span>)),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    Actor <span class="op">=</span> data.Actors.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">','</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.explode(<span class="st">'Genre'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.explode(<span class="st">'Actor'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.assign(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    Genre <span class="op">=</span> data.Genre.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strip()),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    Actor <span class="op">=</span> data.Actor.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strip())</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">15</span>)[[<span class="st">'Name'</span>, <span class="st">'Year'</span>, <span class="st">'Genre'</span>, <span class="st">'Actor'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Year</th>
      <th>Genre</th>
      <th>Actor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Action</td>
      <td>Diego Luna</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Action</td>
      <td>Kyle Soller</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Action</td>
      <td>Stellan Skarsgård</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Action</td>
      <td>Genevieve O'Reilly</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Adventure</td>
      <td>Diego Luna</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Adventure</td>
      <td>Kyle Soller</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Adventure</td>
      <td>Stellan Skarsgård</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Adventure</td>
      <td>Genevieve O'Reilly</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Diego Luna</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Kyle Soller</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Stellan Skarsgård</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Andor</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Genevieve O'Reilly</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Peripheral</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Chloë Grace Moretz</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Peripheral</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Gary Carr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Peripheral</td>
      <td>2022–</td>
      <td>Drama</td>
      <td>Jack Reynor</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Nice! Now we can compare actors and genres!</p>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p>It is here we’ll need to step aside since there were problems which this data. I believe I found this while exploring some basic questions but in effect, there are parenthesis included in the <code>Year</code> column:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data.Year.loc[data.Year.<span class="bu">str</span>.contains(<span class="st">'\('</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>45     II) (2020–2023
45     II) (2020–2023
45     II) (2020–2023
45     II) (2020–2023
45     II) (2020–2023
            ...      
474     I) (2013–2016
474     I) (2013–2016
474     I) (2013–2016
474     I) (2013–2016
474     I) (2013–2016
Name: Year, Length: 192, dtype: object</code></pre>
</div>
</div>
<p>Now, we could read each column and replace all these values but I think the better idea here will be to simply correct the source data. Keep in mind that if this is a dataset which pandas struggles with due to it’s size then going with the replace is going to be the better option but I corrected the Source file in this instance. To fix this, I ran these two lines:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'s|II) (||'</span>  data/AllThrillerSeriesList.csv <span class="op">&gt;</span> data/AllThrillerSeriesListCleaned.csv</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'s|I) (||'</span>  data/AllThrillerSeriesListCleaned.csv <span class="op">&gt;</span> data/AllThrillerSeriesListClean.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You should always keep the original copy around in case you need to undo damage that you did in your analysis on accident. Regardless of our best intentions, that will sometimes happen and you’ll want to be able to start again.</p>
<p>Sadly, this still was not enough as there were more problems to fix. When I added more rows, I found that there was extra information in some of the Ratings columns - namely there was a attached <code>| Gross</code> which showed up:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[data]$</span> grep <span class="at">-i</span> gross AllThrillerSeriesList.csv </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">85,Mindhunter,2017–2019,TV-MA</span> , 60 min ,<span class="st">" Crime, Drama, Mystery"</span>,8.6,<span class="st">" Jonathan Groff, Holt McCallany, Anna Torv, Hannah Gross"</span>,<span class="st">" 288,604"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">669,Wallander,2005–2013,TV-14</span> , 90 min ,<span class="st">" Crime, Drama, Mystery"</span>,7.6,<span class="st">" Krister Henriksson, Fredrik Gunnarsson, Mats Bergman, Douglas Johansson"</span>,<span class="st">" 5,844 | Gross"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">736,The</span> Brave,2017–2018,TV-14 , 43 min ,<span class="st">" Action, Drama, Thriller"</span>,7.5,<span class="st">" Anne Heche, Mike Vogel, Tate Ellington, Demetrius Grosse"</span>,<span class="st">" 9,208"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ex">931,Gongjo,2017–</span> ,Not Rated , 124 min ,<span class="st">" Action, Comedy, Drama"</span>,6.6,<span class="st">" Hyun Bin, Hae-Jin Yoo, Ju-hyuk Kim, Lee Hae-Young"</span>,<span class="st">" 3,637 | Gross"</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1115,Crisis,2014,,60</span> min ,<span class="st">" Action, Drama, Thriller"</span>,7.0,<span class="st">" Dermot Mulroney, Rachael Taylor, Lance Gross, James Lafferty"</span>,<span class="st">" 8,498"</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ex">1181,Hello</span> Monster,2015,,,<span class="st">"Action, Crime, Mystery"</span>,7.7,<span class="st">" Seo In-Guk, Jang Na-ra, Park Bo-gum, Choi Wonyoung"</span>,<span class="st">" 1,542 | Gross"</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1978,Deadwax,2018–</span> ,,,<span class="st">"Horror, Music, Mystery"</span>,6.7,<span class="st">" Hannah Gross, Evan Gamble, Tracy Perez, Dohn Norwood"</span>, 397</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[data]$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I admit that I simply went into the dataset and deleted them the first time around. But, that was because I already had the file open after finding out that the <code>Names</code> field was also not clean. Meaning that some of the names were not quoted like they should of been:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">2220,Keple,s</span><span class="er">)</span> <span class="kw">(</span><span class="ex">2018–2019,,,</span><span class="st">"Crime, Drama, Mystery"</span><span class="ex">,6.1,</span><span class="st">" Marc Lavoine, Sofia Essaïdi, Isabelle Renauld, Serge Riaboukine"</span><span class="ex">,</span> 97</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you look that TV Show up you’ll find that it’s name is <code>Kepler(s)</code> which is going to be a problem.</p>
<section id="if-we-had-a-data-engineer" class="level3">
<h3 class="anchored" data-anchor-id="if-we-had-a-data-engineer">If We Had a Data Engineer…</h3>
<p>So, about now if we had a Data Engineer then we should reach out about how this all is being processed and cleaned up. These kinds of problems are going to make the analysis hard until we get these corrected upstream. In my case, since I have no say in the original data, we’re going to have to step back and investigate our replaces once again to make sure we’re not malforming the names when we substitute.</p>
<p>Reseting the data and checking through the data for the <code>) (</code> to look for fields which need to be correct, I found that there was another tier up of these weird patterns: <code>III) (</code>. So, these are our replaces with sed:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'s|III) (||'</span>  data/AllThrillerSeriesList.csv <span class="op">&gt;</span> data/AllThrillerSeriesListCleaned.csv</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="st">'s|II) (||'</span>  data/AllThrillerSeriesListCleaned.csv</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="st">'s|I) (||'</span>  data/AllThrillerSeriesListCleaned.csv</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'s|) (||'</span>  data/AllThrillerSeriesListCleaned.csv <span class="op">&gt;</span> data/AllThrillerSeriesListClean.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I also found at least four rows where we’ll need to add proper quotations marks around the values:</p>
<pre><code>369,The Guardians of Justice,Will Save You!) (2022– ,TV-MA , 30 min ," Animation, Action, Adventure",5.0," Dallas Page, Sharni Vinson, Denise Richards, Zachery Ty Bryan"," 3,279"

2258,Doute Raisonnable,Reasonable Doubt) (2021– ,,60 min , Thriller,6.9," Marc-André Grondin, Julie Perreault, Kathleen Fortin, Dominik Dagenais", 39

2550,The Hunt for Salamander,Otdel Izdirvane) (2021– ,,,Thriller,9.1," Martin Radoev, Iva Mihalic, Hristo Petkov, Julian Vergov", 67

2760,Loabat Al Moot,Game of Death) (2013–2014,,57 min ," Drama, Family, Romance",6.2," Cyrine AbdelNour, Nicolas Mouawad, Nada Abou Farhat, Abed Fahd", 55</code></pre>
<p>Just to show how this was updated:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[Nbks]$</span> grep <span class="at">-E</span> <span class="st">"349,|2258,|2550,|2760,"</span> data/AllThrillerSeriesListClean.csv </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">349,La</span> Reina del Sur,2011– ,TV-MA , 378 min ,<span class="st">" Action, Crime, Drama"</span>,7.9,<span class="st">" Kate del Castillo, Humberto Zurita, Alejandro Calva, Isabella Sierra"</span>,<span class="st">" 2,728"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1349,Matrix,1993,,60</span> min ,<span class="st">" Action, Drama, Fantasy"</span>,7.8,<span class="st">" Nick Mancuso, Phillip Jarrett, Carrie-Anne Moss, John Vernon"</span>, 199</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2258,</span><span class="st">"Doute Raisonnable,Reasonable Doubt"</span><span class="ex">,</span> 2021– ,,60 min , Thriller,6.9,<span class="st">" Marc-André Grondin, Julie Perreault, Kathleen Fortin, Dominik Dagenais"</span>, 39</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2349,Swift</span> Justice,1996,,,<span class="st">"Action, Crime, Thriller"</span>,7.0,<span class="st">" James McCaffrey, Emerson St. John, Tony Darrow, Alex Kilgore"</span>, 61</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">2550,</span><span class="st">"The Hunt for Salamander,Otdel Izdirvane"</span><span class="ex">,</span> 2021– ,,,Thriller,9.1,<span class="st">" Martin Radoev, Iva Mihalic, Hristo Petkov, Julian Vergov"</span>, 67</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2760,</span><span class="st">"Loabat Al Moot,Game of Death"</span><span class="ex">,</span> 2013–2014,,57 min ,<span class="st">" Drama, Family, Romance"</span>,6.2,<span class="st">" Cyrine AbdelNour, Nicolas Mouawad, Nada Abou Farhat, Abed Fahd"</span>, 55</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[Nbks]$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we should have most of the issues ironed out to start trying to ask some fun questions.</p>
</section>
</section>
<section id="what-kinds-of-movies" class="level2">
<h2 class="anchored" data-anchor-id="what-kinds-of-movies">What kinds of Movies…?</h2>
<p>Now we an start asking some questions about the data before we move to Spark. Looking at the data here are some fun questions: 1. Given a Genre, what is the average rating and the average number of votes? 2. Given an actor, what is the averagae rating and the average number of votes? 3. Given the Guide, what is the average rating and the average number of votes? 4. Given the Starting Year, what is the average rating and the average number of votes?</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given a Genre, what is the average rating and the average number of votes?</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'Genre'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>Genre</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Biography</th>
      <td>8.300000</td>
      <td>109127.333333</td>
    </tr>
    <tr>
      <th>Animation</th>
      <td>8.221622</td>
      <td>46288.783784</td>
    </tr>
    <tr>
      <th>Crime</th>
      <td>7.627799</td>
      <td>69710.181467</td>
    </tr>
    <tr>
      <th>Mystery</th>
      <td>7.568966</td>
      <td>63459.632184</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>7.545455</td>
      <td>49638.090909</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>7.545000</td>
      <td>24758.975000</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>7.537500</td>
      <td>72898.041667</td>
    </tr>
    <tr>
      <th>Action</th>
      <td>7.526994</td>
      <td>51595.000000</td>
    </tr>
    <tr>
      <th>Thriller</th>
      <td>7.511034</td>
      <td>56173.862069</td>
    </tr>
    <tr>
      <th>Short</th>
      <td>7.500000</td>
      <td>90451.500000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Wow, I did not expect <strong>Biography</strong> to be the most well rated category in the data. I like that though and wonder what kind of movies and shows are in that list; A question for another time.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given an actor, what is the averagae rating and the average number of votes?; Best</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'Actor'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>Actor</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aaron Paul</th>
      <td>9.5</td>
      <td>1872005.0</td>
    </tr>
    <tr>
      <th>Anna Gunn</th>
      <td>9.5</td>
      <td>1872005.0</td>
    </tr>
    <tr>
      <th>Betsy Brandt</th>
      <td>9.5</td>
      <td>1872005.0</td>
    </tr>
    <tr>
      <th>Lance Reddick</th>
      <td>9.3</td>
      <td>339583.0</td>
    </tr>
    <tr>
      <th>Dominic West</th>
      <td>9.3</td>
      <td>339583.0</td>
    </tr>
    <tr>
      <th>Pratik Gandhi</th>
      <td>9.3</td>
      <td>144344.0</td>
    </tr>
    <tr>
      <th>Anjali Barot</th>
      <td>9.3</td>
      <td>144344.0</td>
    </tr>
    <tr>
      <th>Shreya Dhanwanthary</th>
      <td>9.3</td>
      <td>144344.0</td>
    </tr>
    <tr>
      <th>Sonja Sohn</th>
      <td>9.3</td>
      <td>339583.0</td>
    </tr>
    <tr>
      <th>Hemant Kher</th>
      <td>9.3</td>
      <td>144344.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'Actor'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>).tail(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>Actor</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Zachery Ty Bryan</th>
      <td>5.0</td>
      <td>3279.0</td>
    </tr>
    <tr>
      <th>Denise Richards</th>
      <td>5.0</td>
      <td>3279.0</td>
    </tr>
    <tr>
      <th>Ella Balinska</th>
      <td>4.1</td>
      <td>40569.0</td>
    </tr>
    <tr>
      <th>Tamara Smart</th>
      <td>4.1</td>
      <td>40569.0</td>
    </tr>
    <tr>
      <th>Adeline Rudolph</th>
      <td>4.1</td>
      <td>40569.0</td>
    </tr>
    <tr>
      <th>Siena Agudong</th>
      <td>4.1</td>
      <td>40569.0</td>
    </tr>
    <tr>
      <th>Sandra Reyes</th>
      <td>2.4</td>
      <td>3510.0</td>
    </tr>
    <tr>
      <th>Constanza Camelo</th>
      <td>2.4</td>
      <td>3510.0</td>
    </tr>
    <tr>
      <th>Diego Trujillo</th>
      <td>2.4</td>
      <td>3510.0</td>
    </tr>
    <tr>
      <th>Roberto Urbina</th>
      <td>2.4</td>
      <td>3510.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Some of these I recognize and some I don’t. Nothing too interesting I think here.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given the Guide, what is the average rating and the average number of votes?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'Guide'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>Guide</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>TV-Y7-FV</th>
      <td>7.900000</td>
      <td>11485.000000</td>
    </tr>
    <tr>
      <th>TV-PG</th>
      <td>7.737895</td>
      <td>31579.273684</td>
    </tr>
    <tr>
      <th>TV-14</th>
      <td>7.622013</td>
      <td>72887.157233</td>
    </tr>
    <tr>
      <th>TV-Y7</th>
      <td>7.562500</td>
      <td>15830.000000</td>
    </tr>
    <tr>
      <th>TV-MA</th>
      <td>7.539541</td>
      <td>77243.647773</td>
    </tr>
    <tr>
      <th>Not Rated</th>
      <td>7.392857</td>
      <td>11184.071429</td>
    </tr>
    <tr>
      <th>PG-13</th>
      <td>6.700000</td>
      <td>3289.000000</td>
    </tr>
    <tr>
      <th>TV-13</th>
      <td>6.600000</td>
      <td>1404.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Now this is somewhat interesting. The <code>FV</code> means there is <em>Fantasy Violence</em>; the <code>PG</code> means <em>Parental Guidance</em>. The top ratings are more mature shows with an emphasis on violence. Considering the data we have - and who is certainly voting - this means audiences generally like violence more than they do not.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'startYear'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>startYear</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1959</th>
      <td>9.100000</td>
      <td>83920.000000</td>
    </tr>
    <tr>
      <th>1955</th>
      <td>8.500000</td>
      <td>17597.000000</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>8.466667</td>
      <td>67447.000000</td>
    </tr>
    <tr>
      <th>1974</th>
      <td>8.350000</td>
      <td>7413.500000</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>8.333333</td>
      <td>84556.000000</td>
    </tr>
    <tr>
      <th>1961</th>
      <td>8.300000</td>
      <td>8012.000000</td>
    </tr>
    <tr>
      <th>1971</th>
      <td>8.300000</td>
      <td>35793.000000</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>8.266667</td>
      <td>84247.666667</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>8.214286</td>
      <td>205522.428571</td>
    </tr>
    <tr>
      <th>1963</th>
      <td>8.150000</td>
      <td>6364.500000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data.groupby(<span class="st">'startYear'</span>)[[<span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]].mean().sort_values(<span class="st">'Ratings'</span>, ascending<span class="op">=</span><span class="va">False</span>).tail(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Ratings</th>
      <th>Votes</th>
    </tr>
    <tr>
      <th>startYear</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018</th>
      <td>7.360870</td>
      <td>40269.934783</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>7.347826</td>
      <td>23647.582609</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>7.325000</td>
      <td>29279.000000</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>7.301563</td>
      <td>30649.367188</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>7.247200</td>
      <td>29343.368000</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>7.206550</td>
      <td>16209.716157</td>
    </tr>
    <tr>
      <th>1976</th>
      <td>7.200000</td>
      <td>6567.000000</td>
    </tr>
    <tr>
      <th>1984</th>
      <td>7.200000</td>
      <td>14867.333333</td>
    </tr>
    <tr>
      <th>1973</th>
      <td>7.000000</td>
      <td>5353.500000</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>6.950000</td>
      <td>3397.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The older shows are doing much better than the newer shows. There are some older years which do not do well; what happened in the 70s?</p>
</section>
<section id="lets-add-apache-spark" class="level2">
<h2 class="anchored" data-anchor-id="lets-add-apache-spark">Let’s Add Apache Spark</h2>
<p>If you’re not aware then <a href="https://spark.apache.org">Apache Spark</a> is a tool for large scale data analytics. I’m sure it is used for Data Engineering as well since it can clean data at a massive scale - but we’re not going to use it for that today.</p>
<p>You can use Spark from python quite easily and without needing a cluster. Just <code>python3 -m pip install pyspark</code> and you’re off. I would definitely recommend that you modify the logging level which gets pushed into the terminal since this makes working and reading much easier. Also, if you’re following along and you want to restart spark then you’ll need to run <code>sc.stop()</code> or what you named your spark context.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conf for config; context spark "cluster"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkConf, SparkContext</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> SparkConf().setMaster(<span class="st">"local[*]"</span>).setAppName(<span class="st">"play"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> SparkContext(conf <span class="op">=</span> conf)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>sc.setLogLevel(<span class="st">"ERROR"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># session to talk to the "cluster"</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.appName(<span class="st">"play"</span>).getOrCreate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve already identified the data types we want so we’ll tag them on import. To do this, we’ll need <code>types</code> since this is not brought in by default.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> <span class="op">*</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the schema:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>shows <span class="op">=</span> StructType([</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Ignore'</span>, IntegerType(), <span class="va">True</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Name'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Year'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Guide'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Duration'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Genres'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Ratings'</span>, FloatType(), <span class="va">True</span>),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Actors'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    StructField(<span class="st">'Votes'</span>, StringType(), <span class="va">True</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And, now we bring in the data.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> spark.read.csv(<span class="bu">str</span>(Path(<span class="st">'data'</span>, <span class="st">'AllThrillerSeriesListClean.csv'</span>)), header<span class="op">=</span><span class="va">True</span>, schema<span class="op">=</span>shows)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
|Ignore|                Name|     Year| Guide|Duration|              Genres|Ratings|              Actors|     Votes|
+------+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
|     0|               Andor|   2022– |TV-14 | 40 min | Action, Adventur...|    8.4| Diego Luna, Kyle...|    82,474|
|     1|      The Peripheral|   2022– |TV-MA |    null| Drama, Mystery, ...|    8.0| Chloë Grace More...|    34,768|
|     2|    The Walking Dead|2010–2022|TV-MA | 44 min | Drama, Horror, T...|    8.1| Andrew Lincoln, ...|   988,666|
|     3|      Criminal Minds|   2005– |TV-14 | 42 min | Crime, Drama, My...|    8.1| Kirsten Vangsnes...|   198,262|
|     4|        Breaking Bad|2008–2013|TV-MA | 49 min | Crime, Drama, Th...|    9.5| Bryan Cranston, ...| 1,872,005|
|     5|                Dark|2017–2020|TV-MA | 60 min | Crime, Drama, My...|    8.7| Louis Hofmann, K...|   384,702|
|     6|            Manifest|   2018– |TV-14 | 43 min | Drama, Mystery, ...|    7.1| Melissa Roxburgh...|    66,158|
|     7|     Stranger Things|   2016– |TV-14 | 51 min | Drama, Fantasy, ...|    8.7| Millie Bobby Bro...| 1,179,168|
|     8|Guillermo del Tor...|   2022– |TV-MA | 60 min | Drama, Horror, M...|    7.1| Lize Johnston, K...|    33,660|
|     9|              Echo 3|   2022– |TV-MA | 49 min | Action, Drama, T...|    6.6| Michiel Huisman,...|     1,333|
+------+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
only showing top 10 rows
</code></pre>
</div>
</div>
<p>And, now we need to repeat what we prototyped in the pandas starting with dropping the column.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(<span class="st">'Ignore'</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
|                Name|     Year| Guide|Duration|              Genres|Ratings|              Actors|     Votes|
+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
|               Andor|   2022– |TV-14 | 40 min | Action, Adventur...|    8.4| Diego Luna, Kyle...|    82,474|
|      The Peripheral|   2022– |TV-MA |    null| Drama, Mystery, ...|    8.0| Chloë Grace More...|    34,768|
|    The Walking Dead|2010–2022|TV-MA | 44 min | Drama, Horror, T...|    8.1| Andrew Lincoln, ...|   988,666|
|      Criminal Minds|   2005– |TV-14 | 42 min | Crime, Drama, My...|    8.1| Kirsten Vangsnes...|   198,262|
|        Breaking Bad|2008–2013|TV-MA | 49 min | Crime, Drama, Th...|    9.5| Bryan Cranston, ...| 1,872,005|
|                Dark|2017–2020|TV-MA | 60 min | Crime, Drama, My...|    8.7| Louis Hofmann, K...|   384,702|
|            Manifest|   2018– |TV-14 | 43 min | Drama, Mystery, ...|    7.1| Melissa Roxburgh...|    66,158|
|     Stranger Things|   2016– |TV-14 | 51 min | Drama, Fantasy, ...|    8.7| Millie Bobby Bro...| 1,179,168|
|Guillermo del Tor...|   2022– |TV-MA | 60 min | Drama, Horror, M...|    7.1| Lize Johnston, K...|    33,660|
|              Echo 3|   2022– |TV-MA | 49 min | Action, Drama, T...|    6.6| Michiel Huisman,...|     1,333|
+--------------------+---------+------+--------+--------------------+-------+--------------------+----------+
only showing top 10 rows
</code></pre>
</div>
</div>
<p>We need to replicate the custom functions like we did with the <code>isOngoing</code> column. To do this, we’ll need to define our own functions in Spark and that requires <strong>User Defined Functions</strong>. There are different ways to do this but I think my favorite so far - which is the closest to a python lambda function - is defining it and using it inline:</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect the ability to define udfs</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'isOngoing'</span>,     <span class="co"># Target this column</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    F.udf(                              <span class="co"># define a udf</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x.strip()[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">'–'</span>) <span class="co"># use the logic we already wrote.</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Year'</span>)                            <span class="co"># pass the column we're applying this to.</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>data.select(<span class="st">'isOngoing'</span>).show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+
|isOngoing|
+---------+
|     true|
|     true|
|    false|
|     true|
|    false|
|    false|
|     true|
|     true|
|     true|
|     true|
+---------+
only showing top 10 rows
</code></pre>
</div>
</div>
<p>With that, we can easily apply what we wrote before:</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'startYear'</span>, F.udf( <span class="kw">lambda</span> x: x.split(<span class="st">'–'</span>)[<span class="dv">0</span>])(<span class="st">'Year'</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.udf( <span class="kw">lambda</span> x: <span class="bu">int</span>(x.replace(<span class="st">','</span>, <span class="st">''</span>)))(<span class="st">'Votes'</span>))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.cast(IntegerType(), data[<span class="st">'Votes'</span>]))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>data.show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+---------+------+--------+--------------------+-------+--------------------+-------+---------+---------+
|                Name|     Year| Guide|Duration|              Genres|Ratings|              Actors|  Votes|isOngoing|startYear|
+--------------------+---------+------+--------+--------------------+-------+--------------------+-------+---------+---------+
|               Andor|   2022– |TV-14 | 40 min | Action, Adventur...|    8.4| Diego Luna, Kyle...|  82474|     true|     2022|
|      The Peripheral|   2022– |TV-MA |    null| Drama, Mystery, ...|    8.0| Chloë Grace More...|  34768|     true|     2022|
|    The Walking Dead|2010–2022|TV-MA | 44 min | Drama, Horror, T...|    8.1| Andrew Lincoln, ...| 988666|    false|     2010|
|      Criminal Minds|   2005– |TV-14 | 42 min | Crime, Drama, My...|    8.1| Kirsten Vangsnes...| 198262|     true|     2005|
|        Breaking Bad|2008–2013|TV-MA | 49 min | Crime, Drama, Th...|    9.5| Bryan Cranston, ...|1872005|    false|     2008|
|                Dark|2017–2020|TV-MA | 60 min | Crime, Drama, My...|    8.7| Louis Hofmann, K...| 384702|    false|     2017|
|            Manifest|   2018– |TV-14 | 43 min | Drama, Mystery, ...|    7.1| Melissa Roxburgh...|  66158|     true|     2018|
|     Stranger Things|   2016– |TV-14 | 51 min | Drama, Fantasy, ...|    8.7| Millie Bobby Bro...|1179168|     true|     2016|
|Guillermo del Tor...|   2022– |TV-MA | 60 min | Drama, Horror, M...|    7.1| Lize Johnston, K...|  33660|     true|     2022|
|              Echo 3|   2022– |TV-MA | 49 min | Action, Drama, T...|    6.6| Michiel Huisman,...|   1333|     true|     2022|
+--------------------+---------+------+--------+--------------------+-------+--------------------+-------+---------+---------+
only showing top 10 rows
</code></pre>
</div>
</div>
<p>The Actors and Genre work is easy in spark since it’s inbuilt. We’ll just split and explode like we did in pandas - but in spark:</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.split(data[<span class="st">'Genres'</span>], <span class="st">','</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.explode(data[<span class="st">'Genre'</span>]))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.split(data[<span class="st">'Actors'</span>], <span class="st">','</span>))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.explode(data[<span class="st">'Actor'</span>]))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Gotta clean up the inputs:</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Genre'</span>, F.udf(<span class="kw">lambda</span> x: x.strip())(<span class="st">'Genre'</span>))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Actor'</span>, F.udf(<span class="kw">lambda</span> x: x.strip())(<span class="st">'Actor'</span>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.withColumn(<span class="st">'Votes'</span>, F.udf( <span class="kw">lambda</span> x: <span class="bu">int</span>(x) )(<span class="st">'Votes'</span>))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>data.select(</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Name'</span>, <span class="st">'Year'</span>, <span class="st">'Guide'</span>, </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Duration'</span>, <span class="st">'Ratings'</span>, <span class="st">'Votes'</span>, </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isOngoing'</span>, <span class="st">'startYear'</span>, <span class="st">'Genre'</span>, <span class="st">'Actor'</span>]</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>).show(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
| Name|  Year| Guide|Duration|Ratings|Votes|isOngoing|startYear|    Genre|             Actor|
+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|       Kyle Soller|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action| Stellan Skarsgård|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|   Action|Genevieve O'Reilly|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|       Kyle Soller|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure| Stellan Skarsgård|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|Adventure|Genevieve O'Reilly|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|    Drama|        Diego Luna|
|Andor|2022– |TV-14 | 40 min |    8.4|82474|     true|     2022|    Drama|       Kyle Soller|
+-----+------+------+--------+-------+-----+---------+---------+---------+------------------+
only showing top 10 rows
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DELETE</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- Name: string (nullable = true)
 |-- Year: string (nullable = true)
 |-- Guide: string (nullable = true)
 |-- Duration: string (nullable = true)
 |-- Genres: string (nullable = true)
 |-- Ratings: float (nullable = true)
 |-- Actors: string (nullable = true)
 |-- Votes: string (nullable = true)
 |-- isOngoing: string (nullable = true)
 |-- startYear: string (nullable = true)
 |-- Genre: string (nullable = true)
 |-- Actor: string (nullable = true)
</code></pre>
</div>
</div>
<p>One mistake that will be eventually made is using other aggregation functions like pandas or the builtin to try to do aggregations. But, Spark has its own versions of these. You can find them under <code>pyspark.sql.functions</code> and import them as you like:</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> mean <span class="im">as</span> sMean, col</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    data.select([<span class="st">'Genre'</span>, <span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]).groupBy(<span class="st">'Genre'</span>).agg(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        sMean(<span class="st">'Ratings'</span>).alias(<span class="st">"Mean"</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        sMean(<span class="st">'Votes'</span>).alias(<span class="st">'Votes'</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        ).orderBy(F.desc(<span class="st">"Mean"</span>)).show()</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( e )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+------------------+------------------+
|    Genre|              Mean|             Votes|
+---------+------------------+------------------+
|Biography| 7.795238108862014| 33137.95238095238|
|    Music| 7.474999845027924|           413.625|
|  History| 7.416666656732559|3330.5416666666665|
|Animation| 7.270712390319233| 8447.388742304309|
|  Fantasy| 7.231312224012695|18573.573755656107|
|Adventure| 7.228473101449998| 8999.588235294117|
|    Crime| 7.225606645016681|15978.954034326298|
|   Comedy| 7.223730058905348| 4206.774310595065|
|   Family| 7.207407372969168| 635.7592592592592|
|    Drama|7.2038561880837015| 17351.69541427827|
|     News| 7.199999809265137|              28.0|
|  Mystery| 7.192586999365133|15005.853252647505|
|   Action|7.1531927343807755| 11602.80236925744|
|  Romance| 7.139181296727811|3810.4619883040937|
| Thriller| 7.113366268083392| 6469.523950617284|
|   Horror| 7.089073947713345|15463.994670219854|
|   Sci-Fi| 7.085540543375789|21185.131081081083|
|    Sport| 7.033333460489909| 281.3333333333333|
|      War| 6.940000057220459|             756.2|
|    Short| 6.932031240314245|      6693.5390625|
+---------+------------------+------------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<p>There are some which are definitely outliers - like Music, News and War. Biography is still a hard winner though.</p>
<p>There is no plotting functions inside of Spark so you will need to pull the data for visualizations. Spark has a handy function <code>.toPandas()</code> which will pull the data out and convert it into a pandas data frame for usage. Please make sure when you do this to only pull the results and not the totality of the data.</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> data.select([<span class="st">'Genre'</span>, <span class="st">'Ratings'</span>, <span class="st">'Votes'</span>]).groupBy(<span class="st">'Genre'</span>).agg(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    sMean(<span class="st">'Ratings'</span>).alias(<span class="st">"Mean"</span>),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    sMean(<span class="st">'Votes'</span>).alias(<span class="st">'Votes'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    ).orderBy(F.desc(<span class="st">"Mean"</span>)).toPandas()</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>results.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Genre</th>
      <th>Mean</th>
      <th>Votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Biography</td>
      <td>7.795238</td>
      <td>33137.952381</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Music</td>
      <td>7.475000</td>
      <td>413.625000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>History</td>
      <td>7.416667</td>
      <td>3330.541667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Animation</td>
      <td>7.270712</td>
      <td>8447.388742</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Fantasy</td>
      <td>7.231312</td>
      <td>18573.573756</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Adventure</td>
      <td>7.228473</td>
      <td>8999.588235</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Crime</td>
      <td>7.225607</td>
      <td>15978.954034</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Comedy</td>
      <td>7.223730</td>
      <td>4206.774311</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Family</td>
      <td>7.207407</td>
      <td>635.759259</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Drama</td>
      <td>7.203856</td>
      <td>17351.695414</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">18</span>,<span class="dv">7</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> results.sort_values(<span class="st">'Votes'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ax.bar(tmp.Genre, tmp.Votes)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes By Category'</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax.twinx()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>ax2.scatter(tmp.Genre, tmp.Mean, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, labels<span class="op">=</span>[<span class="st">'Rating Mean'</span>])</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Vote Counts Vs Rating"</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.title("Relationships Between Votes and Their Ratings")</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-12-24-Exploring-Tv-Data-With-Spark-Part-1_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="conclusions-and-thoughts" class="level1">
<h1>Conclusions and Thoughts</h1>
<p>There is a lot more we can do with this so we’ll defintely continue in another post. It’s questionable for data at this scale but it’s good practice. Maybe next time we’ll explore more of the Machine Learning tools Spark grants us.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>